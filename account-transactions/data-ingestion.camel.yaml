# camel-k: language=yaml dependency=mvn:org.postgresql:postgresql:42.7.3 

- route:
    id: data-ingestion
    description: Data ingestion
    from:
      id: from-2954
      description: Consume transactions
      uri: kafka:transactions
      parameters:
        brokers: kafka.rm066rh-dev.svc.cluster.local:9092
        clientId: data-ingestion-client
        saslJaasConfig: org.apache.kafka.common.security.scram.ScramLoginModule required";
      steps:
        - unmarshal:
            id: unmarshal-1178
            description: Parse CSV format
            csv:
              allowMissingColumnNames: true
              trim: true
        - split:
            id: split-6116
            description: Split CSV records
            steps: []
            disabled: false
            expression:
              simple:
                expression: ${body}
        - log:
            id: log-2438
            message: ${body}
- beans:
    - name: PostgresqlDataSource
      properties:
        databaseName: "{{secret:postgres/database-name}}"
        password: "{{secret:postgres/database-password}}"
        portNumber: "5432"
        serverName: postgres.rm066rh-dev.svc.cluster.local
        user: "{{secret:postgres/database-user}}"
      type: org.postgresql.ds.PGSimpleDataSource
